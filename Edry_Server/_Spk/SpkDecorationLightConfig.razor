@inherits ForsightTester.Shared.AccordionInputBase

<div class="motor-wrapper my-2 mx-2">
    <div class="accordion accordion-primary" id="accordion_@IdPrefix">
        <div class="accordion-item motor-card overflow-visible">
            <h2 class="accordion-header" id="heading_@IdPrefix">
                <button class="accordion-button"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapse_@IdPrefix"
                aria-controls="collapse_@IdPrefix"
                aria-expanded="true"
                style="background: transparent;">
                    Decoration Light Config
                </button>
            </h2>

            <div id="collapse_@IdPrefix"
            class="accordion-collapse collapse show"
            aria-labelledby="heading_@IdPrefix"
            data-bs-parent="#accordion_@IdPrefix">

                <div class="accordion-body" style="padding:0;">
                    <table class="table table-sm motor-table mb-0" style="@TableStyle">
                        <thead>
                            <tr>
                                <th class="text-center" style="width:20%;">Name</th>
                                <th class="text-center" style="width:30%;">Color</th>
                                <th class="text-center" style="width:50%;">Interval</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < LightConfigHeaders.Length; i++)
                            {
                                int Locali = i; // capture the current index for the lambda expression
                                <tr>
                                    <td class="text-left">@LightConfigHeaders[Locali]</td>
                                    <td class="text-center">
                                        <div class="dropdown-center">
                                            <button class="btn @GetColor(LightConfigHeaders[Locali]) dropdown-toggle w-75"
                                            type="button"
                                            id="@($"dropdownBtn_{IdPrefix}_{Locali}")"
                                            data-bs-toggle="dropdown"
                                            aria-expanded="false">
                                                @ColorValues[Locali]
                                            </button>

                                            <ul class="dropdown-menu" aria-labelledby="@($"dropdownBtn_{IdPrefix}_{Locali}")">
                                                @foreach (var option in ConfigColorOptions)
                                                {
                                                    <li>
                                                        <a class="dropdown-item"
                                                        href="javascript:void(0);"
                                                        @onclick="() => SelectColorOption(Locali, option)">
                                                            @option
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="dropdown-center">
                                            <button class="btn @GetColor(LightConfigHeaders[Locali]) dropdown-toggle w-75"
                                                    type="button"
                                                    id="@($"dropdownBtn_{IdPrefix}_{Locali}")"
                                                    data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                @IntervalValues[Locali]
                                            </button>

                                            <ul class="dropdown-menu" aria-labelledby="@($"dropdownBtn_{IdPrefix}_{Locali}")">
                                                @foreach (var option in ConfigIntervalsOptions)
                                                {
                                                    <li>
                                                        <a class="dropdown-item"
                                                           href="javascript:void(0);"
                                                           @onclick="() => SelectIntervalOption(Locali, option)">
                                                            @option
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            }

                            <tr>
                                <td colspan="3" class="text-center h-100">
                                    <div class="d-flex justify-content-center align-items-end gap-2 h-100">
                                        <button class="btn btn-sm motor-btn w-15"
                                                @onclick="CyclePatternsClicked"
                                                title="Cycle Patterns">
                                            Cycle Patterns
                                        </button>

                                        <button class="btn btn-sm motor-btn w-15"
                                                @onclick="StartStopClicked"
                                                title="Cycle Patterns">
                                            @StartStopCaption
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    /* ---------- data ---------- */
    // private List<string> ConfigColorOptions { get; } =
    //         ["Pattern 0", "Pattern 1", "Pattern 2", "Pattern 3", "Pattern 4", "Pattern 5", "Pattern 6", "Pattern 7", "Pattern 8", "Pattern 9"];
    private List<string> ConfigColorOptions { get; } = MSGS.Utils.LedIniLoader.LedColorPatternNames.ToList();
    private List<string> ConfigIntervalsOptions { get; } = MSGS.Utils.LedIniLoader.LedIntervalPatternNames.ToList();

    [Parameter] public string IdPrefix { get; set; } = Guid.NewGuid().ToString("N");
    [Parameter] public string? TableStyle { get; set; }
    [Parameter] public string[] ColorValues { get; set; } = Array.Empty<string>();
    [Parameter] public string[] IntervalValues { get; set; } = Array.Empty<string>();
    [Parameter] public EventCallback CyclePatternsClicked { get; set; }
    [Parameter] public string[] LightConfigHeaders { get; set; } = Array.Empty<string>();
    [Parameter] public EventCallback StartStopClicked { get; set; }
    [Parameter] public string StartStopCaption { get; set; } = "Start-Stop";

    /* ---------- helper ---------- */
    private void SelectColorOption(int index, string option)
    {
        ColorValues[index] = option;
        StateHasChanged();          // re-render so the button text updates
    }

    private void SelectIntervalOption(int index, string option)
    {
        IntervalValues[index] = option;
        StateHasChanged();          // re-render so the button text updates
    }

    private string GetColor(string header)
    {
        if (header?.IndexOf("Left", StringComparison.OrdinalIgnoreCase) >= 0)
            return "btn-primary1";

        if (header?.IndexOf("Right", StringComparison.OrdinalIgnoreCase) >= 0)
            return "btn-secondary";

        return "btn-primary";
    }
}
