    @inherits ForsightTester.Shared.AccordionInputBase
    @using CardModel

    @* ---------- markup ---------- *@
<div class="motor-wrapper my-2 mx-2">
        <div class="accordion accordion-primary" id="@ParentId">
            <div class="accordion-item motor-card">
                <h2 class="accordion-header" id="@HeadingId">
                    <button class="accordion-button"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#@CollapseId"
                            aria-controls="@CollapseId"
                            aria-expanded="true"
                            style="background: transparent;">
                        Microscope Motion Control
                    </button>
                </h2>

                <div id="@CollapseId"
                     class="accordion-collapse collapse show"
                     aria-labelledby="@HeadingId"
                     data-bs-parent="#@ParentId">

                    <div class="accordion-body" style="padding:0;">
                        <table class="table table-sm motor-table mb-0" style="@TableStyle">
                            <thead>
                                <tr>
                                    <th class="text-center" style="width:34%;">Property</th>
                                    <th class="text-center" style="width:22%;">X Axis</th>
                                    <th class="text-center" style="width:22%;">Y Axis</th>
                                    <th class="text-center" style="width:22%;">Z Axis</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-left text-primary text-bold">Absolute Encoder</td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>@MicroscopeMotionControlValues!.AxisX!.AbsEnc.ToString("F2")</span>
                                            <span>(mm)</span>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>@MicroscopeMotionControlValues!.AxisY!.AbsEnc.ToString("F2")</span>
                                            <span>(mm)</span>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>@MicroscopeMotionControlValues!.AxisZ!.AbsEnc.ToString("F2")</span>
                                            <span>(mm)</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-left text-primary text-bold">Motor step</td>
                                    <td class="text-left">@MicroscopeMotionControlValues!.AxisX!.MotStep.ToString("F2")</td>
                                    <td class="text-left">@MicroscopeMotionControlValues!.AxisY!.MotStep.ToString("F2")</td>
                                    <td class="text-left">@MicroscopeMotionControlValues!.AxisZ!.MotStep.ToString("F2")</td>
                                </tr>
                                <tr>
                                    <td class="text-left text-primary text-bold">Absolute Position</td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <input type="number"
                                                   class="form-control motor-input empty @GetInputClass(MicroscopeMotionControlValues!.AxisX!.AbsPosition)"
                                                    style="max-width:80px;"
                                                    @bind="MicroscopeMotionControlValues!.AxisX!.AbsPosition"
                                                   @bind:event="oninput" />
                                                   <span class="ms-2">(mm)</span>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <input type="number"
                                                   class="form-control motor-input empty @GetInputClass(MicroscopeMotionControlValues!.AxisY!.AbsPosition)"
                                                   style="max-width:80px;"
                                                   @bind="MicroscopeMotionControlValues!.AxisY!.AbsPosition"
                                                   @bind:event="oninput" />
                                                    <span class="ms-2">(mm)</span>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <input type="number"
                                                   class="form-control motor-input empty @GetInputClass(MicroscopeMotionControlValues!.AxisZ!.AbsPosition)"
                                                   style="max-width:80px;"
                                                   @bind="MicroscopeMotionControlValues!.AxisZ!.AbsPosition"
                                                   @bind:event="oninput" />
                                                    <span class="ms-2">(mm)</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-left text-primary text-bold">Relative Position</td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <input type="number"
                                                   class="form-control motor-input empty @GetInputClass(MicroscopeMotionControlValues!.AxisX!.RelativePosition)"
                                                   style="max-width:80px;"
                                                   min="0" max="100"
                                                   @bind="MicroscopeMotionControlValues!.AxisX!.RelativePosition"
                                                   @bind:event="oninput" />
                                                    <span class="ms-2">(mm)</span>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <input type="number"
                                                   class="form-control motor-input empty @GetInputClass(MicroscopeMotionControlValues!.AxisY!.RelativePosition)"
                                                   style="max-width:80px;"
                                                   min="0" max="100"
                                                   @bind="MicroscopeMotionControlValues!.AxisY!.RelativePosition"
                                                   @bind:event="oninput" />
                                                    <span class="ms-2">(mm)</span>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <input type="number"
                                                   class="form-control motor-input empty @GetInputClass(MicroscopeMotionControlValues!.AxisZ!.RelativePosition)"
                                                   style="max-width:80px;"
                                                   min="0" max="100"
                                                   @bind="MicroscopeMotionControlValues!.AxisZ!.RelativePosition"
                                                   @bind:event="oninput" />
                                                    <span class="ms-2">(mm)</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-left text-primary text-bold"></td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <button type="button" class="btn btn-sm mx-md-1 btn-primary btn-wave">RLS Left</button>
                                            <button type="button" class="btn btn-sm mx-md-1 btn-primary btn-wave">FLS Right</button>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <button type="button" class="btn btn-sm mx-md-1 btn-primary btn-wave">RLS Left</button>
                                            <button type="button" class="btn btn-sm mx-md-1 btn-primary btn-wave">FLS Right</button>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <button type="button" class="btn btn-sm mx-md-1 btn-primary btn-wave">RLS Left</button>
                                            <button type="button" class="btn btn-sm mx-md-1 btn-primary btn-wave">FLS Right</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-left text-primary text-bold"></td>
                                    <td colspan="3" class="text-center h-100">
                                        <div class="d-flex flex-column justify-content-end align-items-center h-100">
                                            <button class="btn btn-sm motor-btn w-25"
                                                    @onclick="SendConfig"
                                                    title="Send">
                                                Send
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @code {
        /* ---------- unique IDs via IdPrefix ---------- */
        private string ParentId => $"accordion_MMC_{IdPrefix}";
        private string HeadingId => $"heading_MMC_{IdPrefix}";
        private string CollapseId => $"collapse_MMC_{IdPrefix}";

        /* ---------- original component logic ---------- */

        [Parameter] public string IdPrefix { get; set; } = Guid.NewGuid().ToString("N");
        [Parameter] public string? TableStyle { get; set; }
        [Parameter] public MicroscopeMotionControl? MicroscopeMotionControlValues { get; set; }
        [Parameter] public EventCallback SendConfig { get; set; }

        protected string GetInputClass(string? value)
            => string.IsNullOrWhiteSpace(value)
               ? "empty"
               : (double.TryParse(value, out var n) && n is >= 0 and <= 100000 ? "valid" : "invalid");
    }
